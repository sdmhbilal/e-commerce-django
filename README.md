# E-Commerce Backend

Django + Django REST Framework backend for a full-stack e-commerce platform. Provides REST APIs for products, cart, coupons, and orders, plus an admin dashboard (Jinja2 templates) for staff to manage products, coupons, and orders.

## Tech Stack

- **Python 3** — runtime
- **Django 6** — web framework
- **Django REST Framework** — REST API, token auth
- **PostgreSQL** — database
- **Jinja2** — admin dashboard templates (Django built-in Jinja2 backend)
- **Bootstrap 5** — dashboard UI

## Project Structure

```
config/           # Django project (settings, urls, asgi, wsgi)
shop/
  constants.py    # Headers, settings keys, defaults
  services.py     # Email sending, get_min_order_amount, get_otp_expire_minutes
  api.py          # REST API views
  models.py       # Cart, Order, Product, etc.
  serializers.py
  urls.py
dashboard/        # Admin dashboard: staff-only views and templates
templates/        # Jinja2 templates for dashboard
manage.py
requirements.txt   # pip install -r requirements.txt
.env.example      # Copy to .env and fill in values
```
(db.sqlite3 and media/ are created at runtime and are in .gitignore; do not commit them.)

### Why Some Files Exist (Do Not Remove)

- **`__init__.py`** — Makes a directory a Python package so imports like `from shop.api import ...` work. Required by Python; empty files are normal.
- **`asgi.py`** / **`wsgi.py`** — ASGI/WSGI entry points for deployment (e.g. Daphne, Gunicorn). Generated by Django and required for running the app.
- **`migrations/__init__.py`** — Marks the migrations folder as a package so Django can load migrations.

Removing these will break the project.

## Setup

### 1. Clone and virtualenv

```bash
cd e-commerce-backend
python3 -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
```

### 2. Install dependencies

```bash
pip install -r requirements.txt
```

### 3. Environment

Copy the example env and edit:

```bash
cp .env.example .env
```

Set at least:

- `DJANGO_SECRET_KEY` — long random string for production
- `POSTGRES_DB`, `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_HOST`, `POSTGRES_PORT` — PostgreSQL connection
- `CORS_ALLOWED_ORIGINS` — comma-separated frontend origins (e.g. `http://localhost:3000`)

### 4. Database

Create the PostgreSQL database and user, then:

```bash
python manage.py migrate
python manage.py createsuperuser   # Staff user for dashboard and Django admin
```

If you see "unapplied migration(s)", run `python manage.py migrate` from the project root and restart the server.

### 5. Run

```bash
python manage.py runserver
```

- **API base:** `http://localhost:8000/api/`
- **E‑commerce admin dashboard:** `http://localhost:8000/dashboard/` — products, orders, coupons (Jinja templates; staff login). Use this, not Django’s `/admin/`.
- **Django built‑in admin:** `http://localhost:8000/admin/` — optional.

### Accessing admin (first time)

No admin user exists until you create one. Create a **superuser** (works for both Django admin and the custom dashboard):

```bash
python manage.py createsuperuser
```

Enter username, email, and password when prompted. Then:

| What | URL | Login |
|------|-----|--------|
| **Custom dashboard** (products, coupons, orders) | http://localhost:8000/dashboard/ | Same username/password (must be staff; superuser is staff) |
| **Django admin** (full DB/admin) | http://localhost:8000/admin/ | Same username/password |

If you used the one-time setup script that created a default superuser, use **username:** `admin`, **password:** `admin123` (change in production).

## Admin Dashboard

- **Login:** http://localhost:8000/dashboard/login/ — staff only (default: `admin` / `admin123`; change in production).
- **After login:** Products (list, create, edit, delete), Coupons (list, create, edit, toggle), Orders (list, detail, update status). Navbar shows these when logged in.
- **Quick links:** Home `/dashboard/`, Products `/dashboard/products/`, Add product `/dashboard/products/create/`, Orders `/dashboard/orders/`, Coupons `/dashboard/coupons/`, Logout `/dashboard/logout/`.
- **Email (OTP, order confirmation):** By default emails are printed in the terminal (console backend). For real sending, set in `.env`: `EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend`, `EMAIL_HOST`, `EMAIL_PORT`, `EMAIL_USE_TLS`, `EMAIL_HOST_USER`, `EMAIL_HOST_PASSWORD`, `DEFAULT_FROM_EMAIL`. Optional: `OTP_EXPIRE_MINUTES=15`.

## API Overview

Base URL: `/api/`. All JSON; auth where noted uses `Authorization: Token <token>`.

| Method | Endpoint | Auth | Description |
|--------|----------|------|-------------|
| POST   | `auth/register/` | No | Register; returns `token` |
| POST   | `auth/login/`    | No | Login; returns `token` |
| GET    | `auth/me/`       | Yes | Current user info |
| GET    | `products/`      | No | List active products |
| GET    | `cart/`          | Yes or `X-Cart-Token` | Cart detail |
| POST   | `cart/items/`    | Yes or `X-Cart-Token` | Add item |
| PUT/PATCH | `cart/items/<id>/` | Yes or `X-Cart-Token` | Update quantity |
| DELETE | `cart/items/<id>/delete/` | Yes or `X-Cart-Token` | Remove item |
| POST   | `coupons/validate/` | No | Validate coupon; body e.g. `{"code":"SAVE10","cart_total":"50.00"}` |
| POST   | `orders/`        | Yes or `X-Cart-Token` | Create order from cart (guest checkout supported with cart token) |

- **Guest cart:** Send header `X-Cart-Token: <uuid>` (or query `cart_token`) for unauthenticated users; server creates a guest cart and returns the token in cart responses.

## License

Use as needed for your project.
